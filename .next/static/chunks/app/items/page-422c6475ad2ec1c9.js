(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[220],{63187:function(e,a,s){Promise.resolve().then(s.bind(s,31070))},31070:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return q}});var r=s(57437),t=s(2265),n=s(62869),i=s(95186),l=s(73247),c=s(90740),o=s(99397),d=s(59883),m=s(8530),h=s(33145),x=s(64413),u=s(71533),b=s(15868),p=s(18930),g=s(16275),f=s(96215),j=s(66070),N=s(35974),v=s(84190),z=s(99376);function y(e){var a,s;let{item:t,onEdit:i,onDelete:l}=e,c=(0,z.useRouter)(),o=(e=>{if(!e)return"bg-gradient-to-b from-zinc-700 to-zinc-900";switch(e.toLowerCase()){case"common":return"bg-gradient-to-b from-gray-300 to-gray-500";case"uncommon":return"bg-[#378fff]";case"rare":return"bg-[#0043ff]";case"epic":return"bg-[#941dff]";case"legendary":return"bg-[#ff2586]";case"arcane":return"bg-[#ff0000]";case"nameless":return"bg-gradient-to-b from-yellow-500 to-amber-700";default:return"bg-gradient-to-b from-zinc-700 to-zinc-900"}})(t.rarity),d=(a=t.photo)?a.startsWith("http")?a:a.startsWith("/")?"".concat(m.f_).concat(a):"".concat(m.f_,"/").concat(a):"placeholder.svg";return(0,r.jsxs)(j.Zb,{className:"bg-zinc-900 border-zinc-800 overflow-hidden h-full flex flex-col",children:[(0,r.jsxs)("div",{className:"relative h-48 ".concat(o),children:[(0,r.jsx)(h.default,{src:d||"/placeholder.svg",alt:t.name,fill:!0,className:"object-cover z-10",onError:e=>{e.target.src=m.g8},loading:"lazy"}),(0,r.jsx)("div",{className:"absolute inset-0 bg-gradient-to-t from-zinc-900/80 to-transparent z-20"}),(0,r.jsx)("div",{className:"absolute top-2 left-2 z-30",children:(0,r.jsxs)(N.C,{variant:"outline",className:"bg-zinc-900/80 text-zinc-300 border-zinc-700 text-xs",children:["ID: ",t.id]})}),t.is_market&&(0,r.jsx)("div",{className:"absolute top-2 right-2 z-30",children:(0,r.jsxs)(N.C,{variant:"outline",className:"bg-green-900/80 text-green-300 border-green-700 text-xs",children:[(0,r.jsx)(x.Z,{size:12,className:"mr-1"}),"Market"]})})]}),(0,r.jsxs)(j.aY,{className:"p-4 flex-grow",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,r.jsx)("h3",{className:"font-semibold text-lg line-clamp-1 text-zinc-100",children:t.name}),(0,r.jsxs)(v.h_,{children:[(0,r.jsx)(v.$F,{asChild:!0,children:(0,r.jsxs)(n.z,{variant:"ghost",size:"icon",className:"h-8 w-8 text-zinc-400 hover:text-zinc-100",children:[(0,r.jsx)(u.Z,{size:16}),(0,r.jsx)("span",{className:"sr-only",children:"Actions"})]})}),(0,r.jsxs)(v.AW,{align:"end",className:"bg-zinc-900 border-zinc-800",children:[(0,r.jsxs)(v.Xi,{className:"text-zinc-300 hover:text-zinc-100 focus:text-zinc-100 focus:bg-zinc-800",onClick:i,children:[(0,r.jsx)(b.Z,{size:16,className:"mr-2"}),"Edit"]}),(0,r.jsxs)(v.Xi,{className:"text-red-500 hover:text-red-400 focus:text-red-400 focus:bg-zinc-800",onClick:l,children:[(0,r.jsx)(p.Z,{size:16,className:"mr-2"}),"Delete"]})]})]})]}),(0,r.jsxs)("div",{className:"flex flex-wrap gap-2 mb-3",children:[t.rarity&&(0,r.jsx)(N.C,{variant:"outline",className:(e=>{if(!e)return"border-zinc-700 bg-zinc-800 text-zinc-300";switch(e.toLowerCase()){case"common":return"border-gray-400 bg-gray-300 text-gray-800";case"uncommon":return"border-blue-300 bg-blue-200 text-blue-800";case"rare":return"border-blue-400 bg-blue-300 text-blue-900";case"epic":return"border-purple-400 bg-purple-300 text-purple-900";case"legendary":return"border-pink-400 bg-pink-300 text-pink-900";case"arcane":return"border-red-600 bg-red-500 text-red-950";case"nameless":return"border-yellow-600 bg-yellow-500 text-yellow-900";default:return"border-zinc-700 bg-zinc-800 text-zinc-300"}})(t.rarity),children:t.rarity}),(0,r.jsx)(N.C,{variant:"outline",className:"bg-zinc-800 text-zinc-300 border-zinc-700",children:t.category}),t.typeName&&(0,r.jsx)(N.C,{variant:"outline",className:"bg-zinc-800 text-zinc-300 border-zinc-700",children:t.typeName}),t.is_market&&(0,r.jsxs)(N.C,{variant:"outline",className:"bg-green-800 text-green-300 border-green-700",children:[(0,r.jsx)(g.Z,{size:12,className:"mr-1"}),"На рынке"]})]}),(0,r.jsxs)("div",{className:"space-y-2 text-sm text-zinc-400",children:[t.weaponName&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Weapon:"}),(0,r.jsx)("span",{className:"text-zinc-300",children:t.weaponName})]}),t.collectionName&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Collection:"}),(0,r.jsx)("span",{className:"text-zinc-300",children:t.collectionName})]}),t.created_at&&(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Added:"}),(0,r.jsx)("span",{className:"text-zinc-300",children:(s=t.created_at)?new Date(s).toLocaleDateString():""})]})]})]}),(0,r.jsxs)(j.eW,{className:"p-4 pt-0 flex gap-2 mt-auto",children:[(0,r.jsxs)(n.z,{variant:"outline",size:"sm",className:"flex-1 bg-zinc-800 border-zinc-700 hover:bg-zinc-700 hover:text-zinc-100",onClick:i,children:[(0,r.jsx)(b.Z,{size:14,className:"mr-1"}),"Edit"]}),(0,r.jsxs)(n.z,{variant:"outline",size:"sm",className:"flex-1 bg-zinc-800 border-zinc-700 hover:bg-zinc-700 hover:text-zinc-100",onClick:()=>{c.push("/items/".concat(t.id,"/statistics?name=").concat(encodeURIComponent(t.name)))},children:[(0,r.jsx)(f.Z,{size:14,className:"mr-1"}),"Stats"]}),(0,r.jsxs)(n.z,{size:"sm",className:"flex-1 bg-zinc-800 hover:bg-zinc-700 text-red-400 hover:text-red-300",onClick:l,children:[(0,r.jsx)(p.Z,{size:14,className:"mr-1"}),"Delete"]})]})]})}var w=s(26110),k=s(26815),C=s(53647),_=s(9270),S=s(30401),E=s(94508);let L=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)(_.fC,{ref:a,className:(0,E.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",s),...t,children:(0,r.jsx)(_.z$,{className:(0,E.cn)("flex items-center justify-center text-current"),children:(0,r.jsx)(S.Z,{className:"h-4 w-4"})})})});L.displayName=_.fC.displayName;var O=s(77992),Z=s(51817),A=s(49322),I=s(65613),M=s(32489),R=s(17689);function F(e){let{value:a,onChange:s,onError:l}=e,[c,o]=(0,t.useState)(!1),[d,x]=(0,t.useState)(null),u=(0,t.useRef)(null),b=a?a.startsWith("http")?a:"".concat(m.Pn.items.split("/admin")[0]).concat(a):null,p=async e=>{var a;let r=null===(a=e.target.files)||void 0===a?void 0:a[0];if(r){if(!r.type.startsWith("image/")){x("Пожалуйста, выберите изображение");return}if(r.size>5242880){x("Размер файла не должен превышать 5MB");return}o(!0),x(null);try{let e=new FormData;e.append("file",r);let a=await fetch("/api/upload",{method:"POST",body:e}),t=await a.json();if(!a.ok){if(400===a.status)throw Error("Ошибка валидации: ".concat(t.error||t.detail||"Неверный формат файла"));throw Error("Ошибка загрузки: ".concat(a.status," - ").concat(t.error||"Неизвестная ошибка"))}console.log("Upload response:",t);let n=t.path||"";s(n),x(null)}catch(e){console.error("Error uploading image:",e),x(e instanceof Error?e.message:"Ошибка при загрузке изображения"),l(e instanceof Error?e.message:"Ошибка при загрузке изображения")}finally{o(!1),u.current&&(u.current.value="")}}};return(0,r.jsxs)("div",{className:"space-y-4",children:[d&&(0,r.jsx)(I.bZ,{variant:"destructive",className:"bg-red-900/20 border-red-800 text-red-300",children:(0,r.jsx)(I.X,{children:d})}),b?(0,r.jsxs)("div",{className:"relative w-full h-48 bg-zinc-800 rounded-md overflow-hidden",children:[(0,r.jsx)(h.default,{src:b||"/placeholder.svg",alt:"Preview",fill:!0,className:"object-contain",onError:()=>{x("Не удалось загрузить изображение")}}),(0,r.jsx)(n.z,{type:"button",variant:"destructive",size:"icon",className:"absolute top-2 right-2 h-8 w-8 rounded-full",onClick:()=>{s(""),x(null),u.current&&(u.current.value="")},children:(0,r.jsx)(M.Z,{className:"h-4 w-4"})})]}):(0,r.jsxs)("div",{className:"w-full h-48 bg-zinc-800 rounded-md flex flex-col items-center justify-center border-2 border-dashed border-zinc-700",children:[(0,r.jsx)(R.Z,{className:"h-10 w-10 text-zinc-500 mb-2"}),(0,r.jsx)("p",{className:"text-zinc-500",children:"Загрузите изображение"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(k.Label,{htmlFor:"image-upload",className:"mb-2 block",children:"Загрузить изображение"}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(i.I,{ref:u,id:"image-upload",type:"file",accept:"image/*",onChange:p,disabled:c,className:"bg-zinc-800 border-zinc-700"}),c&&(0,r.jsx)(Z.Z,{className:"h-5 w-5 animate-spin text-zinc-400 mt-2"})]})]})]})}function P(e){let{initialData:a,onSuccess:s,onCancel:l}=e,c=(0,z.useRouter)(),o=!!(null==a?void 0:a.id),[d,h]=(0,t.useState)(!1),[x,u]=(0,t.useState)(null),[b,p]=(0,t.useState)({name:(null==a?void 0:a.name)||"",photo:(null==a?void 0:a.photo)||"",type_id:(null==a?void 0:a.type_id)||"",rarity_id:(null==a?void 0:a.rarity_id)||"",category_id:(null==a?void 0:a.category_id)||"",collection_id:(null==a?void 0:a.collection_id)||"",weapon_id:(null==a?void 0:a.weapon_id)||"",is_market:(null==a?void 0:a.is_market)||!1}),[g,f]=(0,t.useState)([]),[j,N]=(0,t.useState)([]),[v,y]=(0,t.useState)([]),[w,_]=(0,t.useState)([]),[S,E]=(0,t.useState)([]),[M,R]=(0,t.useState)(!0);(0,t.useEffect)(()=>{(async()=>{R(!0);try{let[e,a,s,r,t]=await Promise.all([fetch("/api/types",{next:{revalidate:60}}),fetch("/api/rarities",{next:{revalidate:60}}),fetch("/api/categories",{next:{revalidate:60}}),fetch("/api/collections",{next:{revalidate:60}}),fetch("/api/weapons",{next:{revalidate:60}})]),n=await e.json(),i=await a.json(),l=await s.json(),c=await r.json(),o=await t.json();f(n),N(i),y(l),_(c),E(o)}catch(e){console.error("Error loading form options:",e),(0,O.Am)({title:"Ошибка",description:"Не удалось загрузить данные для формы",variant:"destructive"})}finally{R(!1)}})()},[]);let P=(e,a)=>{p(s=>({...s,[e]:a})),u(null)},D=async e=>{e.preventDefault(),h(!0),u(null);try{let e=["name","type_id","rarity_id","collection_id"].filter(e=>!b[e]);if(e.length>0)throw Error("Пожалуйста, заполните все обязательные поля: ".concat(e.join(", ")));let r={name:b.name,photo:b.photo||null,type_id:Number(b.type_id),rarity_id:Number(b.rarity_id),collection_id:Number(b.collection_id),category_id:b.category_id?Number(b.category_id):null,weapon_id:b.weapon_id?Number(b.weapon_id):null,is_market:!!b.is_market},t=Object.fromEntries(Object.entries(r).filter(e=>{let[a,s]=e;return null!=s&&""!==s})),n=o?"".concat(m.Pn.items,"/").concat(null==a?void 0:a.id):m.Pn.items,i=await fetch(n,{method:o?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),l=await i.json();if(!i.ok){if(400===i.status||422===i.status){let e=l.error||l.message||l.detail||"Неверные данные",a="";throw l.details&&(a="object"==typeof l.details?JSON.stringify(l.details,null,2):l.details),Error("".concat(e).concat(a?"\n".concat(a):""))}throw Error(l.error||"Произошла ошибка при сохранении")}(0,O.Am)({title:"Успешно",description:o?"Предмет обновлен":"Предмет создан"}),c.refresh(),s()}catch(e){console.error("Error saving item:",e),u(e instanceof Error?e.message:"Произошла ошибка при сохранении")}finally{h(!1)}};return M?(0,r.jsxs)("div",{className:"flex justify-center items-center p-8",children:[(0,r.jsx)(Z.Z,{className:"h-8 w-8 animate-spin text-zinc-400"}),(0,r.jsx)("span",{className:"ml-2 text-zinc-400",children:"Загрузка данных..."})]}):(0,r.jsxs)("form",{onSubmit:D,className:"space-y-4",children:[x&&(0,r.jsxs)(I.bZ,{variant:"destructive",className:"bg-red-900/20 border-red-800 text-red-300",children:[(0,r.jsx)(A.Z,{className:"h-4 w-4"}),(0,r.jsx)(I.X,{className:"whitespace-pre-wrap",children:x})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(k.Label,{htmlFor:"name",children:"Название"}),(0,r.jsx)(i.I,{id:"name",value:b.name,onChange:e=>P("name",e.target.value),placeholder:"Введите название предмета",className:"bg-zinc-800 border-zinc-700",required:!0})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(k.Label,{children:"Изображение"}),(0,r.jsx)(F,{value:b.photo,onChange:e=>P("photo",e),onError:e=>u(e)})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(L,{id:"is_market",checked:b.is_market,onCheckedChange:e=>P("is_market",e),className:"border-zinc-700 data-[state=checked]:bg-zinc-700 data-[state=checked]:border-zinc-600"}),(0,r.jsx)(k.Label,{htmlFor:"is_market",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Доступен на рынке"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(k.Label,{htmlFor:"type",children:"Тип"}),(0,r.jsxs)(C.Ph,{value:b.type_id?b.type_id.toString():"",onValueChange:e=>P("type_id",e?Number.parseInt(e):""),children:[(0,r.jsx)(C.i4,{className:"bg-zinc-800 border-zinc-700",children:(0,r.jsx)(C.ki,{placeholder:"Не выбрано"})}),(0,r.jsx)(C.Bw,{className:"bg-zinc-900 border-zinc-700",children:g.map(e=>(0,r.jsx)(C.Ql,{value:e.id.toString(),children:e.name},e.id))})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(k.Label,{htmlFor:"rarity",children:"Редкость"}),(0,r.jsxs)(C.Ph,{value:b.rarity_id?b.rarity_id.toString():"",onValueChange:e=>P("rarity_id",e?Number.parseInt(e):""),children:[(0,r.jsx)(C.i4,{className:"bg-zinc-800 border-zinc-700",children:(0,r.jsx)(C.ki,{placeholder:"Не выбрано"})}),(0,r.jsx)(C.Bw,{className:"bg-zinc-900 border-zinc-700",children:j.map(e=>(0,r.jsx)(C.Ql,{value:e.id.toString(),children:e.name},e.id))})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(k.Label,{htmlFor:"category",children:"Категория"}),(0,r.jsxs)(C.Ph,{value:b.category_id?b.category_id.toString():"",onValueChange:e=>P("category_id",e?Number.parseInt(e):""),children:[(0,r.jsx)(C.i4,{className:"bg-zinc-800 border-zinc-700",children:(0,r.jsx)(C.ki,{placeholder:"Не выбрано"})}),(0,r.jsx)(C.Bw,{className:"bg-zinc-900 border-zinc-700",children:v.map(e=>(0,r.jsx)(C.Ql,{value:e.id.toString(),children:e.name},e.id))})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(k.Label,{htmlFor:"collection",children:"Коллекция"}),(0,r.jsxs)(C.Ph,{value:b.collection_id?b.collection_id.toString():"",onValueChange:e=>P("collection_id",e?Number.parseInt(e):""),children:[(0,r.jsx)(C.i4,{className:"bg-zinc-800 border-zinc-700",children:(0,r.jsx)(C.ki,{placeholder:"Не выбрано"})}),(0,r.jsx)(C.Bw,{className:"bg-zinc-900 border-zinc-700",children:w.map(e=>(0,r.jsx)(C.Ql,{value:e.id.toString(),children:e.name},e.id))})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(k.Label,{htmlFor:"weapon",children:"Оружие"}),(0,r.jsxs)(C.Ph,{value:b.weapon_id?b.weapon_id.toString():"",onValueChange:e=>P("weapon_id",e?Number.parseInt(e):""),children:[(0,r.jsx)(C.i4,{className:"bg-zinc-800 border-zinc-700",children:(0,r.jsx)(C.ki,{placeholder:"Не выбрано"})}),(0,r.jsx)(C.Bw,{className:"bg-zinc-900 border-zinc-700",children:S.map(e=>(0,r.jsx)(C.Ql,{value:e.id.toString(),children:e.name},e.id))})]})]})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,r.jsx)(n.z,{type:"button",variant:"outline",onClick:l,className:"bg-zinc-800 border-zinc-700 hover:bg-zinc-700",children:"Отмена"}),(0,r.jsxs)(n.z,{type:"submit",disabled:d,className:"bg-zinc-700 hover:bg-zinc-600",children:[d&&(0,r.jsx)(Z.Z,{className:"mr-2 h-4 w-4 animate-spin"}),o?"Сохранить":"Создать"]})]})]})}var D=s(37099);function T(e){let{isOpen:a,onClose:s,onConfirm:n,itemId:i,itemName:l}=e,[c,o]=(0,t.useState)(!1),d=async()=>{o(!0);try{if(!(await fetch("/api/items/".concat(i),{method:"DELETE"})).ok)throw Error("Ошибка при удалении предмета");(0,O.Am)({title:"Успешно",description:"Предмет был удален"}),n()}catch(e){console.error("Error deleting item:",e),(0,O.Am)({title:"Ошибка",description:"Не удалось удалить предмет",variant:"destructive"}),s()}finally{o(!1)}};return(0,r.jsx)(D.aR,{open:a,onOpenChange:s,children:(0,r.jsxs)(D._T,{className:"bg-zinc-900 border-zinc-800",children:[(0,r.jsxs)(D.fY,{children:[(0,r.jsx)(D.f$,{children:"Вы уверены?"}),(0,r.jsxs)(D.yT,{className:"text-zinc-400",children:['Вы собираетесь удалить предмет "',l,'". Это действие нельзя отменить.']})]}),(0,r.jsxs)(D.xo,{children:[(0,r.jsx)(D.le,{className:"bg-zinc-800 border-zinc-700 hover:bg-zinc-700 text-zinc-300",disabled:c,children:"Отмена"}),(0,r.jsx)(D.OL,{onClick:e=>{e.preventDefault(),d()},className:"bg-red-600 hover:bg-red-700 focus:ring-red-600",disabled:c,children:c?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Z.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Удаление..."]}):"Удалить"})]})]})})}var V=s(866),W=s(13134),B=s(40875);let X=W.fC,$=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)(W.ck,{ref:a,className:(0,E.cn)("border-b",s),...t})});$.displayName="AccordionItem";let Q=t.forwardRef((e,a)=>{let{className:s,children:t,...n}=e;return(0,r.jsx)(W.h4,{className:"flex",children:(0,r.jsxs)(W.xz,{ref:a,className:(0,E.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180",s),...n,children:[t,(0,r.jsx)(B.Z,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})})});Q.displayName=W.xz.displayName;let Y=t.forwardRef((e,a)=>{let{className:s,children:t,...n}=e;return(0,r.jsx)(W.VY,{ref:a,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...n,children:(0,r.jsx)("div",{className:(0,E.cn)("pb-4 pt-0",s),children:t})})});function q(){let{toast:e}=(0,O.pm)(),[a,s]=(0,t.useState)([]),[m,h]=(0,t.useState)(!0),[x,u]=(0,t.useState)(null),[b,p]=(0,t.useState)({total:0,rarityCount:{},categoryCount:{},collectionCount:{},marketCount:{market:0,notMarket:0}}),[g,f]=(0,t.useState)("");(0,V.X)();let[j,N]=(0,t.useState)(!1),[z,k]=(0,t.useState)(!1),[C,_]=(0,t.useState)(!1),[S,E]=(0,t.useState)(null),[L,Z]=(0,t.useState)(1),[A,I]=(0,t.useState)("all"),[M,R]=(0,t.useState)("all"),[F,D]=(0,t.useState)("all"),[W,B]=(0,t.useState)("all"),[q,U]=(0,t.useState)("all"),[J,K]=(0,t.useState)("name"),[H,G]=(0,t.useState)("asc"),[ee,ea]=(0,t.useState)(""),[es,er]=(0,t.useState)(!1),et=(0,t.useCallback)(e=>{let a={},s={},r={},t={market:0,notMarket:0};return e.forEach(e=>{e.rarity&&(a[e.rarity]?a[e.rarity]++:a[e.rarity]=1),s[e.category]?s[e.category]++:s[e.category]=1,e.collectionName&&(r[e.collectionName]?r[e.collectionName]++:r[e.collectionName]=1),e.is_market?t.market++:t.notMarket++}),{total:e.length,rarityCount:a,categoryCount:s,collectionCount:r,marketCount:t}},[]),en=(0,t.useCallback)(async()=>{try{h(!0);let e=new AbortController,a=setTimeout(()=>e.abort(),1e4),r=await fetch("/api/items",{cache:"no-store",signal:e.signal});if(clearTimeout(a),!r.ok)throw Error("API Error: ".concat(r.status));let t=(await r.json()).map(e=>{var a,s,r,t;return{id:e.id,name:e.name,category:(null==e?void 0:null===(a=e.category)||void 0===a?void 0:a.name)||"",photo:e.photo||"",rarity:e.rarity.name,weaponName:(null==e?void 0:null===(s=e.weapon)||void 0===s?void 0:s.name)||"",collectionName:e.collection.name,typeName:e.type.name,created_at:e.created_at,is_market:e.is_market||!1,type_id:e.type.id,rarity_id:e.rarity.id,category_id:null==e?void 0:null===(r=e.category)||void 0===r?void 0:r.id,collection_id:e.collection.id,weapon_id:null==e?void 0:null===(t=e.weapon)||void 0===t?void 0:t.id}});s(t),p(et(t)),u(null)}catch(a){console.error("Error in data fetching process:",a),u("Ошибка при загрузке данных"),e({title:"Ошибка",description:"Не удалось загрузить список предметов",variant:"destructive"})}finally{h(!1)}},[e,et]);(0,t.useEffect)(()=>{en()},[en]);let ei=(0,t.useMemo)(()=>{let e=new Set,s=new Set,r=new Set,t=new Set;return a.forEach(a=>{a.rarity&&e.add(a.rarity),a.category&&s.add(a.category),a.typeName&&r.add(a.typeName),a.collectionName&&t.add(a.collectionName)}),{rarities:Array.from(e),categories:Array.from(s),types:Array.from(r),collections:Array.from(t)}},[a]),el=(0,t.useMemo)(()=>{let e=a.filter(e=>{let a=e.name.toLowerCase().includes(g.toLowerCase())||e.category.toLowerCase().includes(g.toLowerCase())||e.weaponName&&e.weaponName.toLowerCase().includes(g.toLowerCase())||e.rarity&&e.rarity.toLowerCase().includes(g.toLowerCase())||e.typeName&&e.typeName.toLowerCase().includes(g.toLowerCase())||e.collectionName&&e.collectionName.toLowerCase().includes(g.toLowerCase()),s="all"===A||e.rarity===A,r="all"===M||e.category===M,t="all"===F||e.typeName===F,n="all"===W||e.collectionName===W,i="all"===q||"market"===q&&e.is_market||"not_market"===q&&!e.is_market;return a&&s&&r&&t&&n&&i});return e.sort((e,a)=>{let s,r;switch(J){case"name":default:s=e.name,r=a.name;break;case"rarity":s=e.rarity||"",r=a.rarity||"";break;case"category":s=e.category,r=a.category;break;case"type":s=e.typeName||"",r=a.typeName||"";break;case"collection":s=e.collectionName||"",r=a.collectionName||"";break;case"market":s=e.is_market?"1":"0",r=a.is_market?"1":"0";break;case"date":s=e.created_at||"",r=a.created_at||""}return"asc"===H?s.localeCompare(r):r.localeCompare(s)}),e},[a,g,A,M,F,W,q,J,H]),ec=(0,t.useMemo)(()=>{let e=(L-1)*9;return el.slice(e,e+9)},[el,L]),eo=e=>{f(e),Z(1)},ed=e=>{E(e),k(!0)},em=e=>{E(e),_(!0)},eh=()=>{N(!1),k(!1),en()},ex=()=>(0,r.jsxs)("div",{className:"bg-zinc-900 border border-zinc-800 rounded-lg overflow-hidden h-full",children:[(0,r.jsx)("div",{className:"h-48 bg-zinc-800 animate-pulse"}),(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,r.jsx)("div",{className:"h-6 w-3/4 bg-zinc-800 rounded animate-pulse"}),(0,r.jsx)("div",{className:"h-8 w-8 bg-zinc-800 rounded animate-pulse"})]}),(0,r.jsxs)("div",{className:"flex gap-2 mb-3",children:[(0,r.jsx)("div",{className:"h-6 w-16 bg-zinc-800 rounded animate-pulse"}),(0,r.jsx)("div",{className:"h-6 w-20 bg-zinc-800 rounded animate-pulse"})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("div",{className:"h-4 w-16 bg-zinc-800 rounded animate-pulse"}),(0,r.jsx)("div",{className:"h-4 w-24 bg-zinc-800 rounded animate-pulse"})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("div",{className:"h-4 w-20 bg-zinc-800 rounded animate-pulse"}),(0,r.jsx)("div",{className:"h-4 w-24 bg-zinc-800 rounded animate-pulse"})]})]})]}),(0,r.jsxs)("div",{className:"p-4 pt-0 flex gap-2",children:[(0,r.jsx)("div",{className:"h-9 flex-1 bg-zinc-800 rounded animate-pulse"}),(0,r.jsx)("div",{className:"h-9 flex-1 bg-zinc-800 rounded animate-pulse"})]})]});return(0,r.jsxs)(d.default,{children:[(0,r.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Items"}),(0,r.jsx)("p",{className:"text-zinc-400",children:"Manage your items inventory"})]}),(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:[(0,r.jsxs)("div",{className:"relative flex-grow",children:[(0,r.jsx)(l.Z,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-zinc-500"}),(0,r.jsx)(i.I,{type:"search",placeholder:"Search items...",className:"pl-8 bg-zinc-900 border-zinc-800 focus-visible:ring-zinc-700",value:g,onChange:e=>eo(e.target.value)})]}),(0,r.jsxs)(v.h_,{open:es,onOpenChange:er,children:[(0,r.jsx)(v.$F,{asChild:!0,children:(0,r.jsxs)(n.z,{variant:"outline",className:"bg-zinc-800 border-zinc-700 hover:bg-zinc-700",children:[(0,r.jsx)(c.Z,{size:16,className:"mr-2"}),"Filters"]})}),(0,r.jsxs)(v.AW,{className:"bg-zinc-900 border-zinc-800 w-72 max-h-[70vh] overflow-y-auto",align:"end",sideOffset:8,children:[(0,r.jsx)("div",{className:"sticky top-0 bg-zinc-900 z-10 pt-2 px-2",children:(0,r.jsx)(i.I,{type:"search",placeholder:"Search filters...",className:"mb-2 bg-zinc-800 border-zinc-700",value:ee,onChange:e=>ea(e.target.value)})}),(0,r.jsxs)(X,{type:"multiple",className:"w-full",defaultValue:["sort","market"],children:[(0,r.jsxs)($,{value:"sort",className:"border-zinc-800",children:[(0,r.jsx)(Q,{className:"py-2 px-2 hover:no-underline hover:bg-zinc-800",children:(0,r.jsx)("span",{className:"text-sm font-medium",children:"Sort by"})}),(0,r.jsxs)(Y,{className:"pt-1 pb-2",children:[(0,r.jsx)(v.bO,{checked:"name"===J&&"asc"===H,onCheckedChange:()=>{K("name"),G("asc")},children:"Name (A-Z)"}),(0,r.jsx)(v.bO,{checked:"name"===J&&"desc"===H,onCheckedChange:()=>{K("name"),G("desc")},children:"Name (Z-A)"}),(0,r.jsx)(v.bO,{checked:"date"===J&&"desc"===H,onCheckedChange:()=>{K("date"),G("desc")},children:"Newest first"}),(0,r.jsx)(v.bO,{checked:"date"===J&&"asc"===H,onCheckedChange:()=>{K("date"),G("asc")},children:"Oldest first"})]})]}),(0,r.jsxs)($,{value:"market",className:"border-zinc-800",children:[(0,r.jsx)(Q,{className:"py-2 px-2 hover:no-underline hover:bg-zinc-800",children:(0,r.jsx)("span",{className:"text-sm font-medium",children:"Market Status"})}),(0,r.jsxs)(Y,{className:"pt-1 pb-2",children:[(0,r.jsx)(v.bO,{checked:"all"===q,onCheckedChange:()=>U("all"),children:"All items"}),(0,r.jsx)(v.bO,{checked:"market"===q,onCheckedChange:()=>U("market"),children:"On market"}),(0,r.jsx)(v.bO,{checked:"not_market"===q,onCheckedChange:()=>U("not_market"),children:"Not on market"})]})]}),(0,r.jsxs)($,{value:"rarity",className:"border-zinc-800",children:[(0,r.jsx)(Q,{className:"py-2 px-2 hover:no-underline hover:bg-zinc-800",children:(0,r.jsx)("span",{className:"text-sm font-medium",children:"Rarity"})}),(0,r.jsxs)(Y,{className:"pt-1 pb-2",children:[(0,r.jsx)(v.bO,{checked:"all"===A,onCheckedChange:()=>I("all"),children:"All rarities"}),ei.rarities.filter(e=>!ee||e.toLowerCase().includes(ee.toLowerCase())).map(e=>(0,r.jsx)(v.bO,{checked:A===e,onCheckedChange:()=>I(e),children:e},e))]})]}),(0,r.jsxs)($,{value:"collection",className:"border-zinc-800",children:[(0,r.jsx)(Q,{className:"py-2 px-2 hover:no-underline hover:bg-zinc-800",children:(0,r.jsx)("span",{className:"text-sm font-medium",children:"Collection"})}),(0,r.jsxs)(Y,{className:"pt-1 pb-2",children:[(0,r.jsx)(v.bO,{checked:"all"===W,onCheckedChange:()=>B("all"),children:"All collections"}),ei.collections.filter(e=>!ee||e.toLowerCase().includes(ee.toLowerCase())).map(e=>(0,r.jsx)(v.bO,{checked:W===e,onCheckedChange:()=>B(e),children:e},e))]})]}),(0,r.jsxs)($,{value:"type",className:"border-zinc-800",children:[(0,r.jsx)(Q,{className:"py-2 px-2 hover:no-underline hover:bg-zinc-800",children:(0,r.jsx)("span",{className:"text-sm font-medium",children:"Type"})}),(0,r.jsxs)(Y,{className:"pt-1 pb-2",children:[(0,r.jsx)(v.bO,{checked:"all"===F,onCheckedChange:()=>D("all"),children:"All types"}),ei.types.filter(e=>!ee||e.toLowerCase().includes(ee.toLowerCase())).map(e=>(0,r.jsx)(v.bO,{checked:F===e,onCheckedChange:()=>D(e),children:e},e))]})]})]}),(0,r.jsx)("div",{className:"sticky bottom-0 bg-zinc-900 p-2 border-t border-zinc-800",children:(0,r.jsx)(n.z,{variant:"outline",size:"sm",className:"w-full bg-zinc-800 border-zinc-700 hover:bg-zinc-700",onClick:()=>{I("all"),R("all"),D("all"),B("all"),U("all"),K("name"),G("asc")},children:"Reset All Filters"})})]})]}),(0,r.jsxs)(n.z,{className:"bg-zinc-800 hover:bg-zinc-700",onClick:()=>{N(!0)},children:[(0,r.jsx)(o.Z,{size:18,className:"mr-2"}),"Add Item"]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[(0,r.jsxs)("div",{className:"bg-zinc-900 border border-zinc-800 rounded-lg p-4",children:[(0,r.jsx)("h3",{className:"text-zinc-500 text-sm font-medium mb-2",children:"Total Items"}),(0,r.jsx)("p",{className:"text-2xl font-bold",children:b.total})]}),(0,r.jsxs)("div",{className:"bg-zinc-900 border border-zinc-800 rounded-lg p-4",children:[(0,r.jsx)("h3",{className:"text-zinc-500 text-sm font-medium mb-2",children:"Collections"}),(0,r.jsx)("p",{className:"text-2xl font-bold",children:Object.keys(b.collectionCount).length})]}),(0,r.jsxs)("div",{className:"bg-zinc-900 border border-zinc-800 rounded-lg p-4",children:[(0,r.jsx)("h3",{className:"text-zinc-500 text-sm font-medium mb-2",children:"On Market"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-green-400",children:b.marketCount.market})]}),(0,r.jsxs)("div",{className:"bg-zinc-900 border border-zinc-800 rounded-lg p-4",children:[(0,r.jsx)("h3",{className:"text-zinc-500 text-sm font-medium mb-2",children:"Not on Market"}),(0,r.jsx)("p",{className:"text-2xl font-bold text-red-400",children:b.marketCount.notMarket})]})]}),x&&!m&&(0,r.jsx)("div",{className:"bg-red-900/20 border border-red-800 text-red-300 p-4 rounded-lg mb-6",children:(0,r.jsx)("p",{children:x})}),(0,r.jsxs)("div",{children:[g||"all"!==A||"all"!==M||"all"!==F||"all"!==W||"all"!==q?(0,r.jsxs)("p",{className:"mb-4 text-zinc-400",children:["Найдено результатов: ",el.length]}):null,(0,r.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:m?Array(6).fill(0).map((e,a)=>(0,r.jsx)(ex,{},a)):ec.length>0?ec.map(e=>(0,r.jsx)(y,{item:e,onEdit:()=>ed(e),onDelete:()=>em(e)},e.id)):(0,r.jsx)("div",{className:"col-span-full text-center py-12 text-zinc-400",children:g||"all"!==A||"all"!==M||"all"!==F||"all"!==W||"all"!==q?"Ничего не найдено по вашему запросу":"Предметы не найдены"})})]}),!m&&el.length>9&&(0,r.jsx)(()=>{let e=Math.ceil(el.length/9);return(0,r.jsxs)("div",{className:"flex justify-between items-center mt-4 flex-wrap gap-2",children:[(0,r.jsxs)("div",{className:"text-sm text-zinc-400",children:["Показано ",Math.min((L-1)*9+1,el.length)," -"," ",Math.min(9*L,el.length)," из ",el.length]}),(0,r.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,r.jsx)(n.z,{variant:"outline",size:"sm",onClick:()=>Z(L-1),disabled:1===L,className:"bg-zinc-800 border-zinc-700 hover:bg-zinc-700",children:"Назад"}),Array.from({length:Math.min(e,5)},(a,s)=>{let t=s+1;return e>5&&L>3&&(t=L-3+s)>e&&(t=e-(4-s)),(0,r.jsx)(n.z,{variant:L===t?"default":"outline",size:"sm",onClick:()=>Z(t),className:L===t?"bg-zinc-700":"bg-zinc-800 border-zinc-700 hover:bg-zinc-700",children:t},t)}),(0,r.jsx)(n.z,{variant:"outline",size:"sm",onClick:()=>Z(L+1),disabled:L===e||0===e,className:"bg-zinc-800 border-zinc-700 hover:bg-zinc-700",children:"Вперед"})]})]})},{}),(0,r.jsx)(w.Vq,{open:j,onOpenChange:N,children:(0,r.jsxs)(w.cZ,{className:"bg-zinc-900 border-zinc-800 text-zinc-100 max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,r.jsx)(w.fK,{children:(0,r.jsx)(w.$N,{children:"Добавить новый предмет"})}),(0,r.jsx)(P,{onSuccess:eh,onCancel:()=>N(!1)})]})}),(0,r.jsx)(w.Vq,{open:z,onOpenChange:k,children:(0,r.jsxs)(w.cZ,{className:"bg-zinc-900 border-zinc-800 text-zinc-100 max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,r.jsx)(w.fK,{children:(0,r.jsx)(w.$N,{children:"Редактировать предмет"})}),S&&(0,r.jsx)(P,{initialData:{id:S.id,name:S.name,photo:S.photo,type_id:S.type_id,rarity_id:S.rarity_id,category_id:S.category_id,collection_id:S.collection_id,weapon_id:S.weapon_id,is_market:S.is_market},onSuccess:eh,onCancel:()=>k(!1)})]})}),S&&(0,r.jsx)(T,{isOpen:C,onClose:()=>_(!1),onConfirm:()=>{_(!1),en()},itemId:S.id,itemName:S.name})]})}Y.displayName=W.VY.displayName},35974:function(e,a,s){"use strict";s.d(a,{C:function(){return l}});var r=s(57437);s(2265);var t=s(90535),n=s(94508);let i=(0,t.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function l(e){let{className:a,variant:s,...t}=e;return(0,r.jsx)("div",{className:(0,n.cn)(i({variant:s}),a),...t})}},66070:function(e,a,s){"use strict";s.d(a,{Ol:function(){return l},SZ:function(){return o},Zb:function(){return i},aY:function(){return d},eW:function(){return m},ll:function(){return c}});var r=s(57437),t=s(2265),n=s(94508);let i=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)("div",{ref:a,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...t})});i.displayName="Card";let l=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)("div",{ref:a,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",s),...t})});l.displayName="CardHeader";let c=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)("div",{ref:a,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",s),...t})});c.displayName="CardTitle";let o=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)("div",{ref:a,className:(0,n.cn)("text-sm text-muted-foreground",s),...t})});o.displayName="CardDescription";let d=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)("div",{ref:a,className:(0,n.cn)("p-6 pt-0",s),...t})});d.displayName="CardContent";let m=t.forwardRef((e,a)=>{let{className:s,...t}=e;return(0,r.jsx)("div",{ref:a,className:(0,n.cn)("flex items-center p-6 pt-0",s),...t})});m.displayName="CardFooter"},866:function(e,a,s){"use strict";s.d(a,{X:function(){return t}});var r=s(2265);function t(){let[e,a]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{let e=()=>{a(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),e}}},function(e){e.O(0,[441,681,582,447,624,263,711,883,886,971,117,744],function(){return e(e.s=63187)}),_N_E=e.O()}]);