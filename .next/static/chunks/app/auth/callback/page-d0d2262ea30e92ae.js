(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[453],{18116:function(e,t,r){Promise.resolve().then(r.bind(r,88796))},88796:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var n=r(57437),a=r(2265),c=r(99376),i=r(16023),o=r(51817),u=r(65613),s=r(49322);function l(){let e=(0,c.useRouter)(),t=(0,c.useSearchParams)(),r=(0,a.useRef)(!1),l=(0,a.useRef)(null),d=(0,a.useRef)(!0);return(0,a.useEffect)(()=>{if(r.current)return;let n=async()=>{r.current=!0;try{let r=null==t?void 0:t.get("code");if(!r){l.current="Код авторизации не найден",d.current=!1,a();return}if(!await (0,i.p$)(r)){l.current="Не удалось обменять код на токен",d.current=!1,a();return}e.push("/dashboard")}catch(e){console.error("Auth callback error:",e.message),l.current=e.message||"Произошла ошибка при обработке авторизации",d.current=!1,a()}};function a(){let e=new Event("forceUpdate");window.dispatchEvent(e)}setTimeout(()=>{n()},0);let c=()=>{};return window.addEventListener("forceUpdate",c),()=>{window.removeEventListener("forceUpdate",c)}},[t,e]),(0,n.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-zinc-950 p-4",children:(0,n.jsx)("div",{className:"w-full max-w-md",children:l.current?(0,n.jsxs)(u.bZ,{variant:"destructive",className:"bg-red-900/20 border-red-800 text-red-300",children:[(0,n.jsx)(s.Z,{className:"h-4 w-4"}),(0,n.jsx)(u.Cd,{children:"Ошибка авторизации"}),(0,n.jsx)(u.X,{children:l.current})]}):(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)(o.Z,{className:"h-12 w-12 animate-spin text-zinc-400 mx-auto mb-4"}),(0,n.jsx)("p",{className:"text-zinc-400",children:"Выполняется вход в систему..."})]})})})}},65613:function(e,t,r){"use strict";r.d(t,{Cd:function(){return s},X:function(){return l},bZ:function(){return u}});var n=r(57437),a=r(2265),c=r(90535),i=r(94508);let o=(0,c.j)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),u=a.forwardRef((e,t)=>{let{className:r,variant:a,...c}=e;return(0,n.jsx)("div",{ref:t,role:"alert",className:(0,i.cn)(o({variant:a}),r),...c})});u.displayName="Alert";let s=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("h5",{ref:t,className:(0,i.cn)("mb-1 font-medium leading-none tracking-tight",r),...a})});s.displayName="AlertTitle";let l=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,n.jsx)("div",{ref:t,className:(0,i.cn)("text-sm [&_p]:leading-relaxed",r),...a})});l.displayName="AlertDescription"},16023:function(e,t,r){"use strict";r.d(t,{$8:function(){return u},Ft:function(){return s},gy:function(){return o},p$:function(){return d},ts:function(){return l}});var n=r(8530);let a=!1,c=e=>{localStorage.setItem(n.nd,e)},i=()=>localStorage.getItem(n.nd),o=()=>{localStorage.removeItem(n.nd)},u=()=>!n.FD.requireAuth||!!i(),s=e=>!n.FD.requireAuth||!!e&&n.FD.allowedRoles.includes(e),l=async()=>{if(!n.FD.requireAuth)return null;let e=i();if(!e)return null;try{let t=await fetch(n.Pn.me,{headers:{Authorization:"Bearer ".concat(e)}});if(!t.ok)return 401===t.status&&o(),null;return await t.json()}catch(e){return console.error("Error fetching user data:",e),null}},d=async e=>{if(a)return null;try{a=!0;let t=await fetch("".concat(n.Pn.googleCallback,"?code=").concat(e),{method:"GET"});if(!t.ok){let e=await t.text();throw Error(400===t.status?"Код авторизации недействителен или уже использован":"Не удалось обменять код: ".concat(t.status," ").concat(e))}let r=await t.json(),i=r.token;if(!i)throw Error("Токен не получен");return c(i),{user:r,token:i}}catch(e){throw e}finally{a=!1}}},8530:function(e,t,r){"use strict";r.d(t,{CT:function(){return n},FD:function(){return u},Pn:function(){return a},f_:function(){return c},g8:function(){return i},nd:function(){return o}});let n="https://api.standoff.uz",a={items:"".concat(n,"/admin/api/v1/items"),weapons:"".concat(n,"/admin/api/v1/weapons"),categories:"".concat(n,"/admin/api/v1/categories"),collections:"".concat(n,"/admin/api/v1/collections"),rarities:"".concat(n,"/admin/api/v1/rarities"),types:"".concat(n,"/admin/api/v1/types"),upload:"".concat(n,"/admin/api/v1/upload"),serverStats:"".concat(n,"/admin/api/v1/get-server-stats"),googleLogin:"".concat(n,"/auth/google/login"),googleCallback:"".concat(n,"/auth/google/callback"),me:"".concat(n,"/auth/google/me")},c=n,i="",o="admin_auth_token";"".concat(window.location.protocol,"//").concat(window.location.host);let u={requireAuth:!0,allowedRoles:["admin","moderator"],loginPage:"/login",forbiddenPage:"/forbidden"}},94508:function(e,t,r){"use strict";r.d(t,{cn:function(){return c}});var n=r(61994),a=r(53335);function c(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.m6)((0,n.W)(t))}},49322:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(79205).Z)("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},51817:function(e,t,r){"use strict";r.d(t,{Z:function(){return n}});let n=(0,r(79205).Z)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])}},function(e){e.O(0,[441,971,117,744],function(){return e(e.s=18116)}),_N_E=e.O()}]);